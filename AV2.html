<!DOCTYPE html>
<html>

<head>
  <meta charset="UTF-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <meta property="og:title" content="ConneX | Reffer And Earn Money">
  <meta property="og:site_name" content="ConneX | Reffer And Earn Money">
  <meta property="og:url" content="https://connexr.github.io/ConneX/ConneX">
  <meta property="og:description" content="Reffer & Earn Money | Cash Out Platform Bkash & Nagad | Web Based Platform | ConneX">
  <meta property="og:type" content=website>
  <meta property="og:image" content=asset/cover.webp>
  <!--=============== BOXICONS ===============-->
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
  <link rel="shortcut icon" href="./asset/Logo.ico" type="image/x-icon" />
  <title>Admin Page | Home</title>
  <!-- Add Bootstrap CSS link -->
  <link rel="stylesheet" href="cssjs/bootstrap5.0.1.min.css">
  <!-- Add Bootstrap JavaScript and Popper.js -->
  <script src="cssjs/bootstrap.bundle.min.js"></script>
  <link rel="stylesheet" href="cssjs/adm_style.css">
  <link rel="stylesheet" href="cssjs/toast.css">
</head>

<body>
  <ul class="notifications"></ul>
  <!-- Delete Confirmation Modal -->
  <div class="container">
    <h1>Admin Panel | ConneX | Home <i onclick="window.location.href = `${window.location.origin}/ConneX/ADM_HIST.html`" class="fa-solid fa-repeat"></i></h1>
    <div class="col">
      <div class="row-md-6 mb-3 mb-md-0 d-flex justify-content-between align-items-center">
        <!-- Button to open the Add User modal -->
        <button class="btn btn-primary" data-bs-toggle="modal" data-bs-target="#addUserModal">Add User</button>
        <div id="taccount">
          T Account: ---
        </div>
        <!-- Dropdown for selecting search criteria -->
        <select id="searchCriteria" class="form-select form-select-sm" style="max-width: 150px">
          <option value="id">ID</option>
          <option value="name">Name</option>
          <option value="email">Email</option>
          <option value="division">Division</option>
          <option value="byref">By Admin</option>
          <option value="date">Date</option>
          <option value="money">Money</option>
          <option value="img">Img</option>
          <option value="tref">T.Ref</option>
        </select>
      </div>
      <div class="row-md-6 d-flex align-items-center justify-content-center">
        <!-- Input box for search -->
        <input type="text" id="searchInput" class="form-control form-control-sm" placeholder="Search...">
      </div>
    </div>


    <table id="dynamicTable" class="table table-bordered" style="overflow-x: visible">
      <thead>
        <tr>
          <th>ID</th>
          <th>Name</th>
          <th>Email</th>
          <th>Division</th>
          <th>By</th>
          <th>Date</th>
          <th>Money</th>
          <th>Image</th>
          <th>T.Ref</th>
          <th class="editbtn">Action</th> <!-- Added a new column for Edit and Delete buttons -->
        </tr>
      </thead>
      <tbody>
        <tr>
          <td colspan="7">Nothing to see</td>
        </tr>
      </tbody>
    </table>
  </div>

  <!-- Add User Modal -->
  <div class="modal fade" id="addUserModal" tabindex="-1" aria-labelledby="addUserModalLabel" aria-hidden="true">
    <div class="modal-dialog">
      <div class="modal-content">
        <div class="modal-header">
          <h5 class="modal-title" id="addUserModalLabel">Add User</h5>
          <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
        </div>
        <div class="modal-body">
          <!-- Add your user input fields here (e.g., name, age, month) -->
          <form id="newUserform" required>
            <div class="mb-3">
              <label for="newUserName" class="form-label">Name</label>
              <input type="text" class="form-control" id="newUserName" required>
            </div>
            <div class="mb-3">
              <label for="newUserEmail" class="form-label">Email</label>
              <input type="email" class="form-control" id="newUserEmail" required>
            </div>
            <div class="mb-3">
              <label for="newUserDivision" class="form-label">Division</label>
              <input type="text" class="form-control" id="newUserDivision" required>
            </div>
            <div class="mb-3">
              <label for="newUserPassword" class="form-label">Password</label>
              <input type="password" class="form-control" id="newUserPassword" required>
              <button class="btn btn-outline-secondary" type="button" id="toggleNewUserPassword">Show</button>
            </div>
            <div class="mb-3">
              <label for="newUserRefcd" class="form-label">Reffer Code</label>
              <input type="tel" class="form-control" id="newUserRefcd" required>
            </div>
          </form>
        </div>
        <div class="modal-footer">
          <button class="btn btn-secondary" type="button" onclick="document.getElementById('newUserform').reset();">Reset</button>
          <button type="button" class="btn btn-danger" data-bs-dismiss="modal">Close</button>
          <button type="button" class="btn btn-primary" onclick="validation(event)">Save</button>
        </div>
      </div>
    </div>
  </div>

  <!-- Update User Modal -->
  <div class="modal fade" id="updateUserModal" tabindex="-1" aria-labelledby="updateUserModalLabel" aria-hidden="true">
    <div class="modal-dialog">
      <div class="modal-content">
        <div class="modal-header">
          <h5 class="modal-title" id="updateUserModalLabel">Edit User</h5>
          <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
        </div>
        <div class="modal-body">
          <!-- Add your user input fields here (e.g., name, age, month) -->
          <form id="editUserform">
            <div class="mb-3">
              <label for="editUserName" class="form-label">Name</label>
              <input type="text" class="form-control" id="editUserName">
            </div>
            <div class="mb-3">
              <label for="editUserEmail" class="form-label">Email</label>
              <input type="email" class="form-control" id="editUserEmail">
            </div>
            <div class="mb-3">
              <label for="editUserDivision" class="form-label">Division</label>
              <input type="text" class="form-control" id="editUserDivision">
            </div>
          </form>
        </div>
        <div class="modal-footer">
          <button class="btn btn-secondary" type="button" onclick="document.getElementById('editUserform').reset();">Reset</button>
          <button type="button" class="btn btn-danger" data-bs-dismiss="modal">Close</button>
          <button type="button" class="btn btn-primary" id="fordel">Update</button>
        </div>
      </div>
    </div>
  </div>
  <!-- Image Modal -->
  <div class="modal fade" id="imageModal" tabindex="-1" aria-labelledby="imageModalLabel" aria-hidden="true">
    <div class="modal-dialog">
      <div class="modal-content">
        <div class="modal-header">
          <h5 class="modal-title" id="imageModalLabel">Image Preview | ConneX</h5>
          <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
        </div>
        <div class="modal-body">
          <img src="" id="image" alt="Image" class="img-fluid">
        </div>
        <div class="modal-footer">
          <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
        </div>
      </div>
    </div>
  </div>
  <footer class="footer bg-light text-dark d-flex justify-content-center align-items-center">
    <div>
      <p class="m-0">&copy; 2023 ConneX</p>
    </div>
  </footer>
  <script src="cssjs/toast.js" defer></script>
  <script>
    var initialData;
    var data123;
    //Edit user
    edit()

    function edit() {
      var useragent = navigator.userAgent;
      var cookie_admin = localStorage.getItem('_cookie_adm');

      var link = "https://script.google.com/macros/s/AKfycbxkgrpnvs1PrhkZGUvUfrCaqn1GV0LICADwQbK3BGeiiqtAnu1f_cBHgnfxC8KMaLZ6/exec";
      const queryParams = new URLSearchParams({
        cookie_adm: cookie_admin,
        userAgent: useragent
      });

      const url = `${link}?${queryParams}`;
      fetch(url)
        .then(response => response.json())
        .then(data => returnData(data))
        .catch(error => createToast('error', 'Network Error !'));
    };

    function returnData(data) {
      initialData = data.data;
      // Convert the data into the desired format
      var data = initialData.slice(1).map(function(row) {
        return {
          id: row[0],
          name: row[1],
          email: row[2],
          division: row[3],
          byref: row[4],
          money: row[6],
          img: row[7],
          tref: row[8],
          date: new Date(row[5]).toLocaleDateString('en-US', { day: 'numeric', month: 'short' })
        };
      });
      data123 = data;
      populateTable(data);
    };

    // Reference to the table's tbody element
    var tbody = document.querySelector("#dynamicTable tbody");

    var searchInput = document.querySelector("#searchInput");

    // Function to populate the table with data
    function populateTable(data) {
      tbody.innerHTML = "";

      for (var i = 0; i < data.length; i++) {
        var edit = ` <tr id="tr${data[i].id}">
    <td>${data[i].id}</td>
    <td>${data[i].name}</td>
    <td>${data[i].email}</td>
    <td>${data[i].division}</td>
    <td>${data[i].byref}</td>
    <td>${data[i].date}</td>
    <td>${data[i].money}</td>
    <td onclick="openImageModal('${data[i].img}')" style="text-decoration: underline;
    color: blue;" >Show</td>
    <td>${data[i].tref}</td>
    <td class="editbtn"><button class="btn btn-primary" style="margin-right: 10px" data-bs-toggle="modal" data-bs-target="#updateUserModal" onclick="editRow(${i})">Edit</button></td>
    </tr>`;
        tbody.innerHTML += edit;
        document.getElementById('taccount').innerText = `T Account: ${data.length}`
      }
    }



    var searchInput = document.querySelector("#searchInput");
    var searchCriteria = document.querySelector("#searchCriteria");

    // Function to filter data based on search criteria and term
    function filterData(searchTerm, criteria) {
      searchTerm = searchTerm.toLowerCase();

      var filteredData = data123.filter(function(item) {
        var value = item[criteria].toString().toLowerCase();
        return value.includes(searchTerm);
      });

      return filteredData;
    }

    searchInput.addEventListener("input", function() {
      var searchTerm = searchInput.value;
      var selectedCriteria = searchCriteria.value;
      var filteredData = filterData(searchTerm, selectedCriteria);

      if (filteredData.length === 0) {
        tbody.innerHTML = `<tr><td colspan="7">Nothing to see</td></tr>`;
      } else {
        populateTable(filteredData);
      }
    });




    // Update the setupColumnSorting function to apply CSS classes for sorting indicator and highlighting
    function setupColumnSorting(header, dataIndex) {
      header.addEventListener('click', function() {
        // Remove sorting classes from all headers
        var headers = document.querySelectorAll('th');
        headers.forEach(function(th) {
          th.classList.remove('sorted-asc', 'sorted-desc', 'sorted-column');
        });

        // Toggle the sorting direction
        var currentSort = header.getAttribute('data-sort');
        var newSort = currentSort === 'asc' ? 'desc' : 'asc';
        header.setAttribute('data-sort', newSort);

        // Sort the data array by the selected column
        data123.sort(function(a, b) {
          var valueA = a[dataIndex];
          var valueB = b[dataIndex];

          if (newSort === 'asc') {
            if (valueA < valueB) return -1;
            if (valueA > valueB) return 1;
          } else {
            if (valueA > valueB) return -1;
            if (valueA < valueB) return 1;
          }
          return 0;
        });

        // Apply sorting classes to the sorted column
        header.classList.add('sorted-' + newSort);
        header.classList.add('sorted-column');

        // Repopulate the table with sorted data
        populateTable(data123);
      });
    }
    // Get references to all column headers
    var idHeader = document.querySelector('th:nth-child(1)');
    var nameHeader = document.querySelector('th:nth-child(2)');
    var emailHeader = document.querySelector('th:nth-child(3)');
    var divisionHeader = document.querySelector('th:nth-child(4)');
    var byrefHeader = document.querySelector('th:nth-child(5)');
    var dateHeader = document.querySelector('th:nth-child(6)');
    var moneyHeader = document.querySelector('th:nth-child(7)');
    var imgHeader = document.querySelector('th:nth-child(8)');
    var trfHeader = document.querySelector('th:nth-child(9)');

    // Set up sorting for each column
    setupColumnSorting(idHeader, 'id');
    setupColumnSorting(nameHeader, 'name');
    setupColumnSorting(emailHeader, 'email');
    setupColumnSorting(divisionHeader, 'division');
    setupColumnSorting(byrefHeader, 'byref');
    setupColumnSorting(dateHeader, 'date');
    setupColumnSorting(moneyHeader, 'money');
    setupColumnSorting(imgHeader, 'img');
    setupColumnSorting(trfHeader, 'tref');
  </script>
  <script src="cssjs/adm_main.js"></script>
</body>

</html>